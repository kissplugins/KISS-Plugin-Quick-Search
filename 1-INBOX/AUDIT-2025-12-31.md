# Security & Performance Audit (Top 5)

## 1) Cached plugin inventory exposed to front-end visitors (Critical)
The plugin serializes the entire plugin inventory (names, descriptions, versions, activation state, settings URLs, folder slugs) into `localStorage` on every admin Plugins page load and rehydrates it without any origin scoping beyond the bare domain. Because `localStorage` is shared across front-end and admin pages on the same origin, any script running on the public site can read `pqs_plugin_cache`/`pqs_cache_meta`, disclosing the full plugin list and versions to unauthenticated visitors — valuable intel for targeted exploits and fingerprinting. 【F:plugin-quick-search.js†L301-L399】【F:plugin-quick-search.js†L363-L377】

STATUS: Not Started

**Recommendation:** Move caching to a capability-checked server endpoint, or at minimum keep plugin data in memory/sessionStorage scoped to the admin area and clear it on admin logout/unload. If client-side storage is required, encrypt/scrub sensitive fields and gate reads behind a privilege check.

## 2) Sensitive plugin state persists indefinitely in the browser (High)
Cached data is never cleared after logout, nor is it forcibly expired — the “expiry” check only runs when PQS code executes. The data (including activation state and settings links) remains in `localStorage` until manually removed, meaning anyone with later access to the same browser profile (or any front-end script on the origin) can recover historical plugin metadata even if the admin session ended. 【F:plugin-quick-search.js†L285-L299】【F:plugin-quick-search.js†L397-L399】

**Recommendation:** Add explicit cache invalidation on admin logout/tab close, and enforce TTL by deleting stale entries on read before returning them. Consider using `sessionStorage` plus capability-gated server-side caching instead of persistent localStorage.

STATUS: Not Started


## 3) Expensive plugin enumeration polled every 30s (High)
The cache status page triggers `loadCacheStatus()` on a 30-second interval, and each call invokes `get_plugins()` server-side via admin-ajax. On large sites this repeatedly scans plugin headers and touches the filesystem, creating avoidable load while the page is open. There’s no visibility/idle check to pause polling, so idle tabs can hammer the server. 【F:KISS-quick-search.php†L931-L946】【F:KISS-quick-search.php†L1338-L1355】

**Recommendation:** Gate polling behind page visibility, back off the interval, and return lightweight, cached counts from the server instead of running `get_plugins()` each poll.

STATUS: Not Started

## 4) Highlight box uses undefined configuration (High)
`createHighlightBox` references `highlightSettings.highlight_color` / `highlightSettings.highlight_opacity`, but no such variable exists — only `pluginSettings` is defined. Selecting a plugin triggers a ReferenceError before styles are injected, breaking the highlight effect and potentially halting subsequent UI logic. 【F:plugin-quick-search.js†L1457-L1503】

**Recommendation:** Replace `highlightSettings` with `pluginSettings` (or pass the settings object in), and add guards/tests so the highlight routine fails gracefully.

STATUS: Not Started

## 5) User input injected into RegExp without escaping (Medium)
Relevance scoring builds `new RegExp('\\b' + lowerQuery + '\\b', 'i')` with raw user input. Queries containing backslashes or other metacharacters can throw `SyntaxError` and break searching, or trigger excessive backtracking on crafted inputs, degrading responsiveness. 【F:plugin-quick-search.js†L801-L825】

**Recommendation:** Escape user input before constructing regexes (e.g., replace metacharacters), or avoid dynamic regex by using safer substring/word-boundary checks.

STATUS: Not Started